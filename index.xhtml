<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <title/>
        <link rel="stylesheet" href="resources/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="resources/css/font-awesome.min.css"/>
        <link rel="stylesheet" href="resources/css/styles.css"/>
    </head>
    <body class="xforms">
        <div style="display:none;">
            <xf:model id="m-ca">
                <xf:instance xmlns="">
                    <existca>
              <!-- system config data if running on an appliance, eg network config -->
                        <appliance/>
            
                  <!-- container for all CAs -->
                        <CAs>
                            <CA name="">
                                <keysize>4096</keysize>
                                <expire>1095</expire>
                                <servername/>
                                <capass/>
                                <!-- <expiry-date/> -->
                                <!-- <ca-cert-txt/> -->
                                <country/>
                                <province/>
                                <city/>
                                <org/>
                                <org-unit/>
                                <email/>
                                <certs>
                                    <cert name="" type="" serial=""/>
                                </certs>
                                <pending-requests>
                                    <req name="" type=""/>
                                </pending-requests>
                                <rejected-requests>
                                    <req name="" type="" rej-reason=""/>
                                </rejected-requests>
                            </CA>
                        </CAs>
                    </existca>
                </xf:instance>
                <xf:intance xmlns="" id="i-vars">
                    <data>
                        <capass2/>
                        <cert name="" type="" serial="" keysize="" expire=""/>
                    </data>
                </xf:intance>
                <xf:bind ref="CAs">
                    <xf:bind ref="CA">
                        <xf:bind ref="@name" required="true()"/>
                        <xf:bind ref="keysize" required="true()"/>
                        <xf:bind ref="expire" required="true()" type="xf:integer"/>
                        <xf:bind ref="capass" required="true()" constraint=". = instance('i-vars')/capass2"/>
                        <xf:bind ref="org" required="true()"/>
                        <xf:bind ref="country" required="true()"/>
                    </xf:bind>
                </xf:bind>
                <xf:submission id="s-createCA" method="post" replace="none" resource="modules/create-ca.xql">
                    <xf:action ev:event="xforms-submit-error">
                        <xf:message>Something went terribly wrong</xf:message>
                    </xf:action>
                </xf:submission>
                <xf:instance xmlns="" id="i-vars">
                    <data>
                        <retype/>
                        <mode>create-ca</mode>
                    </data>
                </xf:instance>
                <xf:bind ref="instance('i-vars')">
                    <xf:bind ref="retype" constraint=". = instance()/caPass" required="true()"/>
                </xf:bind>
                <xf:instance xmlns="" id="i-countries" src="data/countries.xml"/>
            </xf:model>
        </div>
        <header>
            <xf:trigger class="-btn -btn-default">
                <xf:label>
                    <i class="fa fa-arrow-left"/>
                </xf:label>
                <xf:toggle case="home"/>
            </xf:trigger>
            <xf:trigger id="ca-config" class="-btn -btn-default">
                <xf:label>Settings <i class="fa fa-gears"/>
                </xf:label>
                <xf:toggle case="create-ca"/>
            </xf:trigger>
        </header>
        <div class="app-name">
            <i class="fa fa-key"/>MeCastle</div>
        <xf:switch id="views" class="bf-panel">
            <xf:case id="home">
<!--                    <ul id="menu">
                        <li>
                            <xf:trigger id="ca-cert" class="-btn -btn-primary">
                                <xf:label>Create CA <i class="fa fa-chevron-right"/></xf:label>
                                <xf:toggle case="create-ca"/>
                            </xf:trigger>
                        </li>
                        <li/>
                            <xf:trigger class="-btn -btn-primary">
                                <xf:label>Create CA</xf:label>
                                <xf:toggle case="create-ca"/>
                            </xf:trigger>
                        <li/>
                        <li/>
                            <xf:trigger class="-btn -btn-primary">
                                <xf:label>Create CA</xf:label>
                                <xf:toggle case="create-ca"/>
                            </xf:trigger>
                        <li/>
                    </ul>
-->
                <h3>All Certificates</h3>
                <table class="table table-hover cert-list ">
                    <thead>
                        <tr>
                            <td>Name</td>
                            <td>Expires</td>
                            <td>Status</td>
                        </tr>
                    </thead>
                    <tr>
                        <td>existdb.org</td>
                        <td>2018-01-01</td>
                        <td title="active">
                            <i class="fa fa-lock fa-lg active"/>
                        </td>
                    </tr>
                    <tr>
                        <td>joern@existsolutions.com</td>
                        <td>2017-01-05</td>
                        <td title="active">
                            <i class="fa fa-lock fa-lg active"/>
                        </td>
                    </tr>
                    <tr>
                        <td>wolfgang@existsolutions.com</td>
                        <td>2017-01-05</td>
                        <td title="pending approval">
                            <i class="fa fa-unlock fa-lg pending"/>
                        </td>
                    </tr>
                    <tr>
                        <td>existsolutions.com</td>
                        <td>2ÃŸ20-04-07</td>
                        <td title="expired">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-lock"/>
                                <i class="fa fa-ban fa-stack-2x text-danger"/>
                            </span>
                        </td>
                    </tr>
                </table>
            </xf:case>
            <xf:case id="create-ca">
                <h3>Your Certificate Authority</h3>
                <xf:group appearance="compact" ref="CAs/CA">
                    <ul>
                        <li>
                            <xf:input ref="@name" class="-form-control">
                                <xf:label>CA Name</xf:label>
                            </xf:input>
                            <div class="hint">The name of your certificate authority e.g. 'my-site.com'</div>
                        </li>
                        <li>
                            <xf:select1 ref="keysize" selection="closed" class="-form-control">
                                <xf:label>Keysize</xf:label>
                                <xf:item>
                                    <xf:label>2048 bit</xf:label>
                                    <xf:value>2048</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>4096 bit</xf:label>
                                    <xf:value>4096</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>8192 bit</xf:label>
                                    <xf:value>8192</xf:value>
                                </xf:item>
                            </xf:select1>
                            <div class="hint">The length of the encryption key</div>
                        </li>
                        <li>
                            <xf:select1 ref="expire" selection="closed" class="-form-control">
                                <xf:label>Expires</xf:label>
                                <xf:item>
                                    <xf:label>1 year</xf:label>
                                    <xf:value>365</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>2 years</xf:label>
                                    <xf:value>730</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>3 years</xf:label>
                                    <xf:value>1095</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>4 years</xf:label>
                                    <xf:value>1460</xf:value>
                                </xf:item>
                                <xf:item>
                                    <xf:label>5 years</xf:label>
                                    <xf:value>1825</xf:value>
                                </xf:item>
                            </xf:select1>
                            <div class="hint">The duration of validity.</div>
                        </li>
                        <li>
                            <xf:secret ref="capass" class="-form-control">
                                <xf:label>CA Password</xf:label>
                            </xf:secret>
                        </li>
                        <li>
                            <xf:secret ref="instance('i-vars')/retype" class="-form-control">
                                <xf:label>Retype CA password</xf:label>
                                <xf:alert>Passwords do not match</xf:alert>
                            </xf:secret>
                        </li>
                        <li>
                            <xf:input ref="servername" class="-form-control">
                                <xf:label>Hostname</xf:label>
                                <xf:hint>existca.example.org</xf:hint>
                            </xf:input>
                        </li>
                        <li class="btn-group">
                            <xf:trigger class="-btn -btn-default create-ca">
                                <xf:label>Create</xf:label>
                                <xf:send submission="s-createCA"/>
                            </xf:trigger>
                        </li>
                    </ul>
                </xf:group>
            </xf:case>
            <xf:case id="expert">
                <xf:group appearance="full" ref="CAs/CA">
                    <ul>
                        <li>
                            <xf:input ref="org">
                                <xf:label>Organisation</xf:label>
                            </xf:input>
                        </li>
                        <li>
                            <xf:input ref="org-unit">
                                <xf:label>Organisational Unit</xf:label>
                            </xf:input>
                        </li>
                        <li>
                            <xf:input ref="province">
                                <xf:label>State / Province</xf:label>
                            </xf:input>
                        </li>
                        <li>
                            <xf:input ref="city">
                                <xf:label>City</xf:label>
                            </xf:input>
                        </li>
                        <li>
                            <xf:select1 ref="country" appearance="minimal">
                                <xf:label>Country</xf:label>
                                <xf:itemset nodeset="instance('i-countries')/country">
                                    <xf:label ref="."/>
                                    <xf:value ref="@code"/>
                                </xf:itemset>
                            </xf:select1>
                        </li>
                        <li>
                            <xf:secret ref="capass">
                                <xf:label>CA Password</xf:label>
                            </xf:secret>
                        </li>
                        <li>
                            <xf:secret ref="instance('i-vars')/retype">
                                <xf:label>Retype CA password</xf:label>
                            </xf:secret>
                        </li>
                        <li>
                            <xf:input ref="email">
                                <xf:label>Email</xf:label>
                            </xf:input>
                        </li>
                    </ul>
                </xf:group>
            </xf:case>
        </xf:switch>

<!--
    default to 4096 for strongest security
-->
<!--            <ul>-->
<!--                <li/>-->
<!--                <li/>-->
<!--                <li/>-->
<!--            </ul>-->

<!--        <menu type="toolbar">-->
<!--            <button id="create">Create</button>-->
<!--            <button id="renew" disabled="disabled">Renew</button>-->
<!--            <button id="revoke" disabled="disabled">Revoke</button>-->
<!--        </menu>-->
        <script type="text/javascript" src="resources/scripts/jquery.min.js"/>
        <script>
            $("tr").on("click",function(){
                console.log("tr clicked");    
            });
        </script>
    </body>
</html>